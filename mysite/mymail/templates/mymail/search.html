{% include "mymail/base.html" %}

{% block content %}

<div class="container ml-2">

{% if user.is_authenticated %}
    <p class="h2 mt-2">{{what_search}}</p>
    {% if messages %}
        <ul class="list-group list-group-flush">
            {% for message in messages %}
                <li class="list-group-item">
                    {% if what_search == "Templates" %}
                        <a style="display:block" href="{% url 'create_from_template' message.url %}" class="text-decoration-none">
                            <div class="h4 text-primary">
                                <div>
                                    {%if message.title%}
                                        {{ message.title　}}
                                    {%else%}
                                        No title
                                    {%endif%}
                                </div>
                                <div class="h6 text-secondary">
                                    {{message.text|slice:":70" }}
                                </div>
                            </div>

                        </a>
                    {% elif what_search == "Received messages" %}
                        {% if message|slice:"1:2" %}
                            {% for m in message|slice:"0:1" %}
                                <a style="display:block" href="{% url 'read_message' m.url %}">
                                    <div class="h4 text-secondary">
                                        <div>
                                            {%if m.title%}
                                                {{ m.title　}}
                                            {%else%}
                                                No title
                                            {%endif%}
                                        </div>
                                        <div class="h6 text-secondary text-truncate">
                                            {{m.text}}
                                        </div>
                                    </div>
                                </a>
                            {% endfor%}
                        {% else %}
                            {% for m in message|slice:"0:1" %}
                                <a style="display:block" href="{% url 'read_message' m.url %}">
                                    <div class="h4 text-primary">
                                        <div>
                                            {%if m.title%}
                                                {{ m.title　}}
                                            {%else%}
                                                No title
                                            {%endif%}
                                        </div>
                                        <div class="h6 text-secondary text-truncate">
                                            {{m.text }}
                                        </div>
                                    </div>
                                </a>
                            {% endfor%}
                        {% endif %}
                    {% else %}
                        <a style="display:block" href="{% url 'read_message' message.url %}">
                            <div class="h4 text-primary">
                                <div>
                                    {%if message.title%}
                                        {{ message.title　}}
                                    {%else%}
                                        No title
                                    {%endif%}
                                </div>
                                <div class="h6 text-secondary text-truncate">
                                    {{message.text}}
                                </div>
                            </div>
                        </a>
                    {% endif %}
                </li>
            {% endfor %}

            {% if prev_page > -1%}
                <a href="{% url 'search_received' prev_page %}">previous</a>
            {% endif %}
            {% if more%}
                <a href="{% url 'search_received' next_page %}">next</a>
            {% endif %}
        </ul>

    {% else %}
        <p>No messages.</p>
    {% endif %}
{% else %}
    <h1 class="ml-5 center text-center">You are not authenticated</h1>
{% endif %}

</div>

{% endblock %}
